$(function () {

    $('input[name=answer]').focus();

    if ($('select[name=type_id]').val() === '2') {
        $('.qcm').show();
    }
    if ($('select[name=type_id]').val() === '3') {
        $('.multiple').show();
        $('.answer').hide();
    }

    $('select[name=type_id]').on('change', function () {
        if ($('select[name=type_id]').val() === '2')
            $('.qcm').fadeIn();
        else
            $('.qcm').fadeOut();

        if ($('select[name=type_id]').val() === '3') {
            $('.multiple').fadeIn();
            $('.answer').fadeOut();
        } else {
            $('.multiple').fadeOut();
            $('.answer').fadeIn();
        }
    });

    $('.delete').on('click', function (e) {
        var link = $(this).parent('form').attr('action'),
            td = $(this).parents('tr'),
            token = $('meta[name=_token]').attr('content');
        e.preventDefault();
        $.confirm({
            theme: 'material',
            animation: 'RotateX',
            closeAnimation: 'RotateX',
            animationSpeed: 1000,
            title: 'Suppression',
            content: 'Êtes-vous sûr de vouloir le supprimer ?',
            confirmButton: 'Oui',
            cancelButton: 'Non',
            confirm: function () {
                $.ajax({
                    url: link,
                    type: 'DELETE',
                    headers: {'X-CSRF-TOKEN': token},
                }).always(function () {
                    td.remove();
                });
            }
        });
    });

    $('#addAnswer').on('click', function (e) {
        e.preventDefault();

        var route = base_url + '/addAnswer',
            token = $('meta[name=_token]').attr('content'),
            addAnswer = $.ajax({
                url: route,
                headers: {'X-CSRF-TOKEN': token},
                type: 'POST',
            });

        addAnswer.done(function (answer_id) {
            $('.answers').append('<div class="col-xs-12 m_answer"><label for="">Réponse</label><input type="hidden" value="' + answer_id + '" name="id_multiple_answer[]"><div class="input-group"><input type="text" class="form-control" name="multiple_answer[]"><span class="input-group-addon deleteAnswer">Supprimer cette réponse</span></div></div>')
        })
    });

    $(document).on('click', '.deleteAnswer', function (e) {
        e.preventDefault();

        var route = base_url + '/deleteAnswer/' + $(this).parents('.m_answer').find('input[type=hidden]').val(),
            token = $('meta[name=_token]').attr('content'),
            $this = $(this).parents('.m_answer'),
            deleteAnswer = $.ajax({
                url: route,
                headers: {'X-CSRF-TOKEN': token},
                type: 'POST',
            });

        deleteAnswer.done(function (question_id) {
            $this.remove();
        })
    });
})